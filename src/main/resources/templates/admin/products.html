<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>PuppyTalk - μƒν’ κ΄€λ¦¬</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div th:replace="~{fragments/navbar :: navbar}"></div>

<div class="container mt-5 mb-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>π“¦ μƒν’ κ΄€λ¦¬</h2>
        <a href="/shop/register" class="btn btn-primary">+ μƒν’ λ“±λ΅</a>
    </div>

    <div class="card shadow-sm">
        <div class="card-body p-0">
            <table class="table table-hover mb-0 align-middle text-center">
                <thead class="table-light">
                <tr>
                    <th>ID</th>
                    <th>μ΄λ―Έμ§€</th>
                    <th>μƒν’λ…</th>
                    <th>κ°€κ²©</th>
                    <th>μ¬κ³ </th>
                    <th>μƒνƒ</th>
                    <th>κ΄€λ¦¬</th>
                </tr>
                </thead>
                <tbody id="product-list"></tbody>
            </table>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    window.addEventListener('DOMContentLoaded', loadProducts);

    async function loadProducts() {
        try {
            const response = await fetch('/api/shop/products'); // μ „μ²΄ μƒν’ μ΅°ν API
            const products = await response.json();
            const listContainer = document.getElementById('product-list');

            let html = '';
            products.forEach(p => {
                // μ‚­μ λ(HIDDEN) μƒν’μ€ λ©λ΅μ—μ„ μ μ™Έν•κ±°λ‚ νλ¦¬κ² ν‘μ‹ (μ—¬κΈ°μ„  ν‘μ‹ν•λ λ±ƒμ§€λ΅ κµ¬λ¶„)
                let statusBadge = p.status === 'ON_SALE' ? '<span class="badge bg-success">νλ§¤μ¤‘</span>' :
                    p.status === 'SOLD_OUT' ? '<span class="badge bg-warning">ν’μ </span>' :
                        '<span class="badge bg-secondary">μ¨κΉ€</span>';

                html += `
                    <tr>
                        <td>${p.id}</td>
                        <td><img src="${p.thumbnailUrl}" width="50" height="50" style="object-fit:cover; border-radius:5px;"></td>
                        <td class="text-start fw-bold">${p.name}</td>
                        <td>${p.price.toLocaleString()}μ›</td>
                        <td>${p.stockQuantity}κ°</td>
                        <td>${statusBadge}</td>
                        <td>
                            <a href="/admin/products/edit?id=${p.id}" class="btn btn-sm btn-outline-primary">μμ •</a>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteProduct(${p.id})">μ‚­μ </button>
                        </td>
                    </tr>
                `;
            });
            listContainer.innerHTML = html;
        } catch (error) {
            console.error(error);
        }
    }

    async function deleteProduct(id) {
        if (!confirm('μ •λ§ μ‚­μ (μ¨κΉ€) μ²λ¦¬ν•μ‹κ² μµλ‹κΉ?\nλ©λ΅μ—μ„ λ³΄μ΄μ§€ μ•κ² λ©λ‹λ‹¤.')) return;
        try {
            const response = await fetch(`/api/shop/products/${id}`, { method: 'DELETE' });
            if (response.ok) {
                alert('μ‚­μ λμ—μµλ‹λ‹¤.');
                loadProducts();
            } else {
                alert('μ‹¤ν¨ν–μµλ‹λ‹¤.');
            }
        } catch (e) {
            alert('μ¤λ¥ λ°μƒ');
        }
    }
</script>
</body>
</html>