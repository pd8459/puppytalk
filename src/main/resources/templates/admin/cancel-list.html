<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>PuppyTalk - ì·¨ì†Œ/í™˜ë¶ˆ ê´€ë¦¬</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

<div th:replace="~{fragments/navbar :: navbar}"></div>

<div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h3 class="d-inline me-2 text-danger">ğŸš¨ ì·¨ì†Œ/í™˜ë¶ˆ ìš”ì²­ ê´€ë¦¬</h3>
            <a href="/admin" class="btn btn-outline-dark btn-sm ms-2">
                <i class="fas fa-arrow-left"></i> ëŒ€ì‹œë³´ë“œë¡œ
            </a>
        </div>
    </div>

    <div class="alert alert-warning">
        <i class="fas fa-info-circle"></i>
        ì´ê³³ì€ ê³ ê°ì´ <strong>ì·¨ì†Œë¥¼ ìš”ì²­í•œ ì£¼ë¬¸</strong>ë§Œ í‘œì‹œë©ë‹ˆë‹¤. ìŠ¹ì¸ ì‹œ <strong>ì¬ê³ ê°€ ìë™ìœ¼ë¡œ ë³µêµ¬</strong>ë©ë‹ˆë‹¤.
    </div>

    <div class="card shadow-sm border-danger">
        <div class="card-body p-0">
            <table class="table table-hover mb-0 text-center align-middle">
                <thead class="table-light">
                <tr>
                    <th>ì£¼ë¬¸ë²ˆí˜¸</th>
                    <th>ìš”ì²­ì¼ì‹œ</th>
                    <th>ì£¼ë¬¸ì</th>
                    <th>í™˜ë¶ˆìƒí’ˆ</th>
                    <th>í™˜ë¶ˆì˜ˆì •ê¸ˆì•¡</th>
                    <th>ìƒíƒœ</th>
                    <th>ì²˜ë¦¬</th>
                </tr>
                </thead>
                <tbody id="cancel-list"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    window.addEventListener('DOMContentLoaded', loadCancelRequests);

    async function loadCancelRequests() {
        const listContainer = document.getElementById('cancel-list');
        try {
            const response = await fetch('/admin/api/cancels');
            const data = await response.json();
            const orders = data.content;

            let html = '';
            if (orders.length === 0) {
                html = '<tr><td colspan="7" class="py-5 text-muted">í˜„ì¬ ë“¤ì–´ì˜¨ ì·¨ì†Œ ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤. ğŸ‰</td></tr>';
            } else {
                orders.forEach(order => {
                    html += `
                        <tr>
                            <td>${order.orderId}</td>
                            <td>${order.orderDate}</td>
                            <td>${order.buyerName}</td>
                            <td class="text-start">${order.orderName}</td>
                            <td class="fw-bold text-danger">${order.totalPrice.toLocaleString()}ì›</td>
                            <td><span class="badge bg-warning text-dark">ì·¨ì†Œìš”ì²­ì¤‘</span></td>
                            <td>
                                <button class="btn btn-danger btn-sm" onclick="approveCancel(${order.orderId})">
                                    <i class="fas fa-check"></i> í™˜ë¶ˆ ìŠ¹ì¸
                                </button>
                            </td>
                        </tr>
                    `;
                });
            }
            listContainer.innerHTML = html;
        } catch (error) {
            console.error(error);
        }
    }

    async function approveCancel(orderId) {
        if (!confirm('ì •ë§ í™˜ë¶ˆ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(ìŠ¹ì¸ ì‹œ ì¬ê³ ê°€ ë³µêµ¬ë©ë‹ˆë‹¤)')) return;

        try {
            const response = await fetch(`/admin/api/cancels/${orderId}/approve`, { method: 'POST' });
            if (response.ok) {
                alert('í™˜ë¶ˆ ì™„ë£Œ! ì¬ê³ ê°€ ë³µêµ¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
                loadCancelRequests();
            } else {
                alert('ì²˜ë¦¬ ì‹¤íŒ¨');
            }
        } catch (error) {
            alert('ì˜¤ë¥˜ ë°œìƒ');
        }
    }
</script>
</body>
</html>